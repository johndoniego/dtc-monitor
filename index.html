<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DTC Tuguegarao Attendance Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    * { font-family: 'Plus Jakarta Sans', sans-serif; }
    .form-section {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    }
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #0ea5e9;
    }
    .section-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    .input-group { margin-bottom: 16px; }
    .input-label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 600;
      color: #334155;
      margin-bottom: 6px;
    }
    .input-label .required { color: #ef4444; }
    .input-field {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.2s ease;
      background: white;
    }
    .input-field:focus {
      outline: none;
      border-color: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }
    .input-field::placeholder { color: #94a3b8; }
    .radio-group { display: grid; gap: 8px; }
    .radio-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: white;
    }
    .radio-option:hover {
      border-color: #0ea5e9;
      background: #f0f9ff;
    }
    .radio-option.selected {
      border-color: #0ea5e9;
      background: #f0f9ff;
    }
    .radio-option input {
      width: 18px;
      height: 18px;
      accent-color: #0ea5e9;
    }
    .checkbox-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    .submit-btn {
      width: 100%;
      padding: 16px 32px;
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      color: white;
      font-size: 16px;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(14, 165, 233, 0.3);
    }
    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      left: 24px;
      max-width: 400px;
      margin-left: auto;
      padding: 16px 24px;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    .toast.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .toast.error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .helper-text {
      font-size: 12px;
      color: #64748b;
      margin-top: 4px;
    }
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    @media (max-width: 768px) {
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    }
    .header-banner {
      background: linear-gradient(135deg, #0c4a6e 0%, #0369a1 50%, #0ea5e9 100%);
      color: white;
      padding: 32px;
      border-radius: 20px;
      margin-bottom: 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .header-banner::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
      animation: shimmer 3s infinite;
    }
    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .logo-container {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 50%;
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .tab-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      color: #64748b;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .tab-button:hover {
      border-color: #0ea5e9;
      background: #f0f9ff;
    }
    .tab-button.active {
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      border-color: #0ea5e9;
      color: white;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .confirmation-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      animation: fadeIn 0.2s ease;
    }
    .confirmation-content {
      background: white;
      padding: 32px;
      border-radius: 16px;
      max-width: 450px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .confirmation-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 24px;
    }
    .confirm-yes {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .confirm-yes:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
    }
    .confirm-no {
      background: white;
      color: #64748b;
      padding: 12px 24px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .confirm-no:hover {
      border-color: #ef4444;
      color: #ef4444;
    }
    .service-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 8px;
    }
    @media (max-width: 768px) {
      .service-grid { grid-template-columns: 1fr; }
    }
    .service-card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 16px;
      border: 3px solid #e2e8f0;
      border-radius: 16px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    .service-card:hover {
      border-color: #0ea5e9;
      background: #f0f9ff;
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(14, 165, 233, 0.15);
    }
    .service-checkbox {
      position: absolute;
      opacity: 0;
      cursor: pointer;
    }
    .service-checkbox:checked + .service-image-container + .service-checkmark {
      opacity: 1;
      transform: scale(1);
    }
    .service-card:has(.service-checkbox:checked) {
      border-color: #10b981;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
    }
    .service-image-container {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      position: relative;
    }
    .service-icon { transition: all 0.3s ease; }
    .service-checkmark {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      opacity: 0;
      transform: scale(0);
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    .service-title {
      font-size: 18px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 4px;
    }
    .service-description {
      font-size: 13px;
      color: #64748b;
      line-height: 1.4;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .animate-spin { animation: spin 1s linear infinite; }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-slate-50 to-sky-50">
  <div id="app" class="h-full overflow-auto">
    <div class="max-w-4xl mx-auto p-6">
      <!-- Header Banner -->
      <div class="header-banner">
        <div class="logo-container">
          <img src="https://i.imgur.com/n99IEoM.png" alt="DICT Region 2 Logo" loading="lazy" style="width: 60px; height: 60px; object-fit: contain;" onerror="this.style.background='linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)'; this.alt='DICT';">
        </div>
        <h1 id="formTitle" class="text-2xl md:text-3xl font-bold mb-2">DTC Tuguegarao Cagayan</h1>
        <p id="orgName" class="text-lg opacity-90">Attendance Monitoring Form</p>
      </div>

      <!-- Tab Navigation -->
      <div class="form-section" style="padding: 8px; margin-bottom: 16px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          <button id="registerTab" class="tab-button active" onclick="switchTab('register')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            Register
          </button>
          <button id="loginTab" class="tab-button" onclick="switchTab('login')">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/></svg>
            Check In
          </button>
        </div>
      </div>

      <!-- Register Form -->
      <form id="attendanceForm" class="tab-content active">
        <!-- Personal Information Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            </div>
            <h2 class="text-xl font-bold text-slate-800">Personal Information</h2>
          </div>
          <!-- Full Name -->
          <div class="grid-4">
            <div class="input-group">
              <label class="input-label">First Name <span class="required">*</span></label>
              <input type="text" id="firstName" class="input-field" placeholder="Juan" required>
            </div>
            <div class="input-group">
              <label class="input-label">Middle Initial</label>
              <input type="text" id="middleInitial" class="input-field" placeholder="D" maxlength="1">
              <p class="helper-text">Optional</p>
            </div>
            <div class="input-group">
              <label class="input-label">Last Name <span class="required">*</span></label>
              <input type="text" id="lastName" class="input-field" placeholder="Dela Cruz" required>
            </div>
            <div class="input-group">
              <label class="input-label">Suffix</label>
              <select id="suffix" class="input-field">
                <option value="">None</option>
                <option value="Jr.">Jr.</option>
                <option value="Sr.">Sr.</option>
                <option value="II">II</option>
                <option value="III">III</option>
                <option value="IV">IV</option>
              </select>
              <p class="helper-text">Optional</p>
            </div>
          </div>
          <!-- Email -->
          <div class="input-group">
            <label class="input-label">Email <span class="required">*</span></label>
            <input type="email" id="email" class="input-field" placeholder="juandelacruz@email.com" required>
            <p class="helper-text">Enter a valid email address</p>
          </div>
          <!-- Gender -->
          <div class="input-group">
            <label class="input-label">Gender <span class="required">*</span></label>
            <div class="radio-group grid-3">
              <label class="radio-option"><input type="radio" name="gender" value="Male" required><span>üë® Male</span></label>
              <label class="radio-option"><input type="radio" name="gender" value="Female"><span>üë© Female</span></label>
              <label class="radio-option"><input type="radio" name="gender" value="Prefer not to say"><span>ü§ê Prefer not to say</span></label>
            </div>
          </div>
          <!-- Birthdate -->
          <div class="input-group">
            <label class="input-label">Birthdate <span class="required">*</span></label>
            <input type="date" id="birthdate" class="input-field" required>
            <p class="helper-text">Select your date of birth</p>
          </div>
          <!-- Age Group (Auto-calculated) -->
          <div class="input-group">
            <label class="input-label">Age Group <span style="color: #64748b; font-weight: normal;">(Auto-calculated)</span></label>
            <div id="ageGroupDisplay" style="padding: 12px 16px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid #0ea5e9; border-radius: 10px; font-size: 16px; font-weight: 600; color: #0c4a6e; text-align: center;">
              Select birthdate to calculate
            </div>
            <input type="hidden" id="ageGroup" name="ageGroup" value="">
          </div>
          <!-- Phone Number -->
          <div class="input-group">
            <label class="input-label">Phone Number <span class="required">*</span></label>
            <input type="tel" id="phone" class="input-field" placeholder="09XXXXXXXXX" pattern="09[0-9]{9}" required>
            <p class="helper-text">Must start with 09 and be 11 digits (e.g., 09171234567)</p>
          </div>
        </div>

        <!-- Location Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            </div>
            <h2 class="text-xl font-bold text-slate-800">Location</h2>
          </div>
          <!-- Nationality -->
          <div class="input-group">
            <label class="input-label">Select Nationality <span class="required">*</span></label>
            <select id="nationality" class="input-field" required>
              <option value="">Select nationality...</option>
              <option value="Filipino">üáµüá≠ Filipino</option>
              <option value="American">üá∫üá∏ American</option>
              <option value="Australian">üá¶üá∫ Australian</option>
              <option value="British">üá¨üáß British</option>
              <option value="Canadian">üá®üá¶ Canadian</option>
              <option value="Chinese">üá®üá≥ Chinese</option>
              <option value="French">üá´üá∑ French</option>
              <option value="German">üá©üá™ German</option>
              <option value="Indian">üáÆüá≥ Indian</option>
              <option value="Indonesian">üáÆüá© Indonesian</option>
              <option value="Italian">üáÆüáπ Italian</option>
              <option value="Japanese">üáØüáµ Japanese</option>
              <option value="Korean">üá∞üá∑ Korean</option>
              <option value="Malaysian">üá≤üáæ Malaysian</option>
              <option value="Spanish">üá™üá∏ Spanish</option>
              <option value="Thai">üáπüá≠ Thai</option>
              <option value="Vietnamese">üáªüá≥ Vietnamese</option>
              <option value="Other">üåç Other</option>
            </select>
          </div>
          <!-- Region -->
          <div class="input-group">
            <label class="input-label">Select Region <span class="required">*</span></label>
            <select id="region" class="input-field" required>
              <option value="">Select region...</option>
              <option value="Region I">Region I ‚Äì Ilocos Region</option>
              <option value="Region II">Region II ‚Äì Cagayan Valley</option>
              <option value="Region III">Region III ‚Äì Central Luzon</option>
              <option value="Region IV-A">Region IV-A ‚Äì CALABARZON</option>
              <option value="Region IV-B">Region IV-B ‚Äì MIMAROPA Region</option>
              <option value="Region V">Region V ‚Äì Bicol Region</option>
              <option value="Region VI">Region VI ‚Äì Western Visayas</option>
              <option value="Region VII">Region VII ‚Äì Central Visayas</option>
              <option value="Region VIII">Region VIII ‚Äì Eastern Visayas</option>
              <option value="Region IX">Region IX ‚Äì Zamboanga Peninsula</option>
              <option value="Region X">Region X ‚Äì Northern Mindanao</option>
              <option value="Region XI">Region XI ‚Äì Davao Region</option>
              <option value="Region XII">Region XII ‚Äì SOCCSKSARGEN</option>
              <option value="Region XIII">Region XIII ‚Äì Caraga</option>
              <option value="NCR">NCR ‚Äì National Capital Region</option>
              <option value="CAR">CAR ‚Äì Cordillera Administrative Region</option>
              <option value="BARMM">BARMM ‚Äì Bangsamoro Autonomous Region</option>
            </select>
          </div>
          <!-- Address -->
          <div class="input-group">
            <label class="input-label">Address <span class="required">*</span></label>
            <div class="grid-2" style="margin-bottom: 12px;">
              <div>
                <input type="text" id="building" class="input-field" placeholder="Building / House No." required>
                <p class="helper-text">Building / House Number *</p>
              </div>
              <div>
                <input type="text" id="street" class="input-field" placeholder="Street Name">
                <p class="helper-text">Street (Optional)</p>
              </div>
            </div>
            <div class="grid-3">
              <div>
                <input type="text" id="barangay" class="input-field" placeholder="Barangay" required>
                <p class="helper-text">Barangay *</p>
              </div>
              <div>
                <input type="text" id="city" class="input-field" placeholder="City / Municipality" required>
                <p class="helper-text">City / Municipality *</p>
              </div>
              <div>
                <input type="text" id="province" class="input-field" placeholder="Province" required>
                <p class="helper-text">Province *</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Professional Information Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg>
            </div>
            <h2 class="text-xl font-bold text-slate-800">Professional Information</h2>
          </div>
          <!-- Sector -->
          <div class="input-group">
            <label class="input-label">Select Sector <span class="required">*</span></label>
            <div class="radio-group grid-3">
              <label class="radio-option"><input type="radio" name="sector" value="Out of school youth" required><span>üìö Out of school youth</span></label>
              <label class="radio-option"><input type="radio" name="sector" value="Student"><span>üéì Student</span></label>
              <label class="radio-option"><input type="radio" name="sector" value="Teacher"><span>üè´ Teacher</span></label>
              <label class="radio-option"><input type="radio" name="sector" value="Professional"><span>üíº Professional</span></label>
              <label class="radio-option"><input type="radio" name="sector" value="Other"><span>üìã Other</span></label>
            </div>
          </div>
          <div class="grid-3">
            <div class="input-group">
              <label class="input-label">Agency <span class="required">*</span></label>
              <input type="text" id="agency" class="input-field" placeholder="Enter agency name" required>
            </div>
            <div class="input-group">
              <label class="input-label">Office / Affiliation <span class="required">*</span></label>
              <input type="text" id="office" class="input-field" placeholder="Enter office/affiliation" required>
            </div>
            <div class="input-group">
              <label class="input-label">Designation / Position <span class="required">*</span></label>
              <input type="text" id="designation" class="input-field" placeholder="Enter position" required>
            </div>
          </div>
        </div>

        <!-- Additional Information Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"/></svg>
            </div>
            <h2 class="text-xl font-bold text-slate-800">Additional Information</h2>
          </div>
          <div class="grid-3">
            <!-- Senior Citizen -->
            <div class="input-group">
              <label class="input-label">Are you a Senior Citizen? <span class="required">*</span></label>
              <div class="checkbox-group">
                <label class="radio-option"><input type="radio" name="seniorCitizen" value="Yes" required><span>‚úÖ Yes</span></label>
                <label class="radio-option"><input type="radio" name="seniorCitizen" value="No"><span>‚ùå No</span></label>
              </div>
            </div>
            <!-- Abled -->
            <div class="input-group">
              <label class="input-label">Are you Abled? <span class="required">*</span></label>
              <div class="checkbox-group">
                <label class="radio-option"><input type="radio" name="abled" value="Yes" required><span>‚úÖ Yes</span></label>
                <label class="radio-option"><input type="radio" name="abled" value="No"><span>‚ùå No</span></label>
              </div>
            </div>
            <!-- Solo Parent -->
            <div class="input-group">
              <label class="input-label">Are you a Solo Parent? <span class="required">*</span></label>
              <div class="checkbox-group">
                <label class="radio-option"><input type="radio" name="soloParent" value="Yes" required><span>‚úÖ Yes</span></label>
                <label class="radio-option"><input type="radio" name="soloParent" value="No"><span>‚ùå No</span></label>
              </div>
            </div>
          </div>
          <!-- Civil Status -->
          <div class="input-group">
            <label class="input-label">Civil Status <span class="required">*</span></label>
            <div class="radio-group grid-4">
              <label class="radio-option"><input type="radio" name="civilStatus" value="Single" required><span>üíç Single</span></label>
              <label class="radio-option"><input type="radio" name="civilStatus" value="Married"><span>üë´ Married</span></label>
              <label class="radio-option"><input type="radio" name="civilStatus" value="Widowed"><span>üïäÔ∏è Widowed</span></label>
              <label class="radio-option"><input type="radio" name="civilStatus" value="Divorced"><span>üìÑ Divorced</span></label>
              <label class="radio-option"><input type="radio" name="civilStatus" value="Separated"><span>‚ÜîÔ∏è Separated</span></label>
              <label class="radio-option"><input type="radio" name="civilStatus" value="Annulled"><span>‚öñÔ∏è Annulled</span></label>
              <label class="radio-option"><input type="radio" name="civilStatus" value="Domestic Partnership"><span>üè† Domestic Partnership</span></label>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" id="submitBtn" class="submit-btn">
          <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
          Submit Registration
        </button>
      </form>

      <!-- Check-In Section -->
      <div id="loginSection" class="tab-content">
        <!-- User Check-in Form -->
        <form id="loginForm">
          <div class="form-section">
            <div class="section-header">
              <div class="section-icon">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
              </div>
              <h2 class="text-xl font-bold text-slate-800">User Check In</h2>
            </div>
            <div id="userInfoBannerContainer"></div>
            <div class="input-group">
              <label for="loginUserId" class="input-label">User ID <span class="required">*</span></label>
              <input type="text" id="loginUserId" class="input-field" placeholder="DT-XXXXX" required maxlength="8" style="text-transform: uppercase;">
              <p class="helper-text">Enter your ID in format: DT-XXXXX (e.g., DT-00001)</p>
            </div>
            <!-- Service Selection -->
            <div class="input-group">
              <label class="input-label">Select Services You Need <span class="required">*</span></label>
              <p class="helper-text" style="margin-bottom: 12px;">Choose at least one service</p>
              <div class="service-grid">
                <label class="service-card">
                  <input type="checkbox" name="services" value="Printing" class="service-checkbox">
                  <div class="service-image-container">
                    <svg class="service-icon" width="80" height="80" fill="#0ea5e9" viewBox="0 0 24 24"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/></svg>
                  </div>
                  <div class="service-checkmark">‚úì</div>
                  <h3 class="service-title">Printing</h3>
                  <p class="service-description">Document printing services</p>
                </label>
                <label class="service-card">
                  <input type="checkbox" name="services" value="PC Use" class="service-checkbox">
                  <div class="service-image-container">
                    <svg class="service-icon" width="80" height="80" fill="#0ea5e9" viewBox="0 0 24 24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg>
                  </div>
                  <div class="service-checkmark">‚úì</div>
                  <h3 class="service-title">PC Use</h3>
                  <p class="service-description">Computer workstation access</p>
                </label>
                <label class="service-card">
                  <input type="checkbox" name="services" value="Training" class="service-checkbox">
                  <div class="service-image-container">
                    <svg class="service-icon" width="80" height="80" fill="#0ea5e9" viewBox="0 0 24 24"><path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/></svg>
                  </div>
                  <div class="service-checkmark">‚úì</div>
                  <h3 class="service-title">Training</h3>
                  <p class="service-description">Skills development programs</p>
                </label>
              </div>
              <div id="serviceError" class="helper-text" style="color: #ef4444; display: none; margin-top: 8px;">
                Please select at least one service
              </div>
            </div>
            <button type="submit" id="loginBtn" class="submit-btn">
              <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/></svg>
              Check In
            </button>
          </div>
        </form>
      </div>

      <!-- Toast Container -->
      <div id="toastContainer"></div>
    </div>
  </div>

  <script>
    // API Base URL
    const API_URL = '';
    
    // Local cache for data
    let registrationData = [];
    let checkinData = [];
    
    
    // Load data from server
    async function loadRegistrations() {
      try {
        const response = await fetch(`${API_URL}/api/registrations`);
        registrationData = await response.json();
        return registrationData;
      } catch (error) {
        console.error('Error loading registrations:', error);
        return [];
      }
    }
    
    async function loadCheckins() {
      try {
        const response = await fetch(`${API_URL}/api/checkins`);
        checkinData = await response.json();
        return checkinData;
      } catch (error) {
        console.error('Error loading check-ins:', error);
        return [];
      }
    }
    
    // Save registration to server
    async function saveRegistration(data) {
      try {
        const response = await fetch(`${API_URL}/api/registrations`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        if (!response.ok) {
          return { success: false, error: result.error || 'Server error', code: result.code };
        }
        registrationData.push(result.data);
        return { success: true, data: result.data };
      } catch (error) {
        console.error('Error saving registration:', error);
        return { success: false, error: 'Cannot connect to server. Make sure the server is running.' };
      }
    }
    
    // Save check-in to server
    async function saveCheckin(data) {
      try {
        const response = await fetch(`${API_URL}/api/checkins`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await response.json();
        if (!response.ok) {
          return { success: false, error: result.error, code: result.code };
        }
        checkinData.push(result.data);
        return { success: true, data: result.data };
      } catch (error) {
        console.error('Error saving check-in:', error);
        return { success: false, error: 'Cannot connect to server.' };
      }
    }
    
    // Check if email exists
    async function checkEmailExists(email) {
      try {
        const response = await fetch(`${API_URL}/api/check-email`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const result = await response.json();
        return result.exists;
      } catch (error) {
        console.error('Error checking email:', error);
        return false;
      }
    }
    
    // Check if user ID exists
    async function checkUserIdExists(userId) {
      try {
        const response = await fetch(`${API_URL}/api/check-userid`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: userId })
        });
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('Error checking user ID:', error);
        return { exists: false, user: null };
      }
    }
    
    // LocalStorage functions
    function saveUserIdToStorage(userId) {
      localStorage.setItem('lastRegisteredUserId', userId);
    }
    
    function getUserIdFromStorage() {
      return localStorage.getItem('lastRegisteredUserId');
    }
    
    function clearUserIdFromStorage() {
      localStorage.removeItem('lastRegisteredUserId');
    }
    
    // Show toast notification
    function showToast(message, type = 'success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          ${type === 'success' 
            ? '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>'
            : '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>'}
        </svg>
        ${message}
      `;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }
    
    // Show confirmation modal
    function showConfirmation() {
      return new Promise((resolve) => {
        const modal = document.createElement('div');
        modal.className = 'confirmation-modal';
        modal.innerHTML = `
          <div class="confirmation-content">
            <div style="text-align: center; margin-bottom: 16px;">
              <svg width="64" height="64" fill="#f59e0b" viewBox="0 0 24 24" style="margin: 0 auto;">
                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
              </svg>
            </div>
            <h3 style="font-size: 20px; font-weight: 700; color: #1e293b; text-align: center; margin-bottom: 8px;">
              Confirm Submission
            </h3>
            <p style="color: #64748b; text-align: center; margin-bottom: 24px;">
              Are you sure you want to submit this information?
            </p>
            <div class="confirmation-buttons">
              <button class="confirm-no" id="confirmNo">‚úï No, Cancel</button>
              <button class="confirm-yes" id="confirmYes">‚úì Yes, Submit</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);

        modal.querySelector('#confirmYes').addEventListener('click', () => {
          modal.remove();
          resolve(true);
        });

        modal.querySelector('#confirmNo').addEventListener('click', () => {
          modal.remove();
          resolve(false);
        });

        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
            resolve(false);
          }
        });
      });
    }
    
    // Switch between main tabs
    function switchTab(tab) {
      const registerTab = document.getElementById('registerTab');
      const loginTab = document.getElementById('loginTab');
      const registerForm = document.getElementById('attendanceForm');
      const loginSection = document.getElementById('loginSection');

      if (tab === 'register') {
        registerTab.classList.add('active');
        loginTab.classList.remove('active');
        registerForm.classList.add('active');
        loginSection.classList.remove('active');
      } else {
        loginTab.classList.add('active');
        registerTab.classList.remove('active');
        registerForm.classList.remove('active');
        loginSection.classList.add('active');
        checkLastRegisteredUser();
      }
    }
    
    
    // Check last registered user
    async function checkLastRegisteredUser() {
      const lastUserId = getUserIdFromStorage();
      if (lastUserId) {
        const userCheck = await checkUserIdExists(lastUserId);
        if (userCheck.exists && userCheck.user) {
          const userIdInput = document.getElementById('loginUserId');
          if (userIdInput && !userIdInput.value) {
            userIdInput.value = lastUserId;
          }
          showUserInfoBanner(userCheck.user);
        } else {
          clearUserIdFromStorage();
        }
      }
    }
    
    // Show user info banner
    function showUserInfoBanner(userRecord) {
      const container = document.getElementById('userInfoBannerContainer');
      container.innerHTML = '';
      
      const fullName = [userRecord.first_name, userRecord.middle_initial, userRecord.last_name, userRecord.suffix]
        .filter(Boolean).join(' ');
      
      const banner = document.createElement('div');
      banner.style.cssText = 'background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 2px solid #10b981; margin-bottom: 16px; padding: 20px; border-radius: 12px;';
      banner.innerHTML = `
        <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
          <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; flex-shrink: 0;">‚úì</div>
          <div style="flex: 1; min-width: 200px;">
            <div style="font-size: 14px; color: #059669; font-weight: 600; margin-bottom: 4px;">WELCOME BACK</div>
            <div style="font-size: 20px; font-weight: 700; color: #064e3b; margin-bottom: 4px;">${fullName}</div>
            <div style="font-size: 14px; color: #065f46;">
              <span style="font-family: monospace; font-weight: 600; background: rgba(255,255,255,0.5); padding: 2px 8px; border-radius: 6px;">${userRecord.user_id}</span>
              <span style="margin: 0 8px;">‚Ä¢</span>
              <span>${userRecord.agency || 'N/A'}</span>
            </div>
          </div>
          <button id="clearUserBtn" style="padding: 10px 16px; background: white; color: #64748b; border: 2px solid #d1d5db; border-radius: 10px; font-weight: 600; cursor: pointer; flex-shrink: 0;">
            ‚úï Not You?
          </button>
        </div>
      `;
      
      container.appendChild(banner);
      
      document.getElementById('clearUserBtn').addEventListener('click', function() {
        clearUserIdFromStorage();
        document.getElementById('loginUserId').value = '';
        container.innerHTML = '';
        showToast('User info cleared');
      });
    }
    
    // Calculate age group from birthdate
    function calculateAgeGroup(birthdate) {
      if (!birthdate) return '';
      
      const today = new Date();
      const birth = new Date(birthdate);
      let age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
      }
      
      if (age < 18) return 'Under 18';
      if (age >= 18 && age <= 24) return '18-24';
      if (age >= 25 && age <= 34) return '25-34';
      if (age >= 35 && age <= 44) return '35-44';
      return '45+';
    }
    
    // Initialize event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Set max date for birthdate
      const birthdateInput = document.getElementById('birthdate');
      const today = new Date().toISOString().split('T')[0];
      birthdateInput.setAttribute('max', today);
      
      // Birthdate change - auto-calculate age group
      birthdateInput.addEventListener('change', function() {
        const ageGroup = calculateAgeGroup(this.value);
        document.getElementById('ageGroup').value = ageGroup;
        const ageGroupDisplay = document.getElementById('ageGroupDisplay');
        if (ageGroup) {
          ageGroupDisplay.textContent = ageGroup;
          ageGroupDisplay.style.background = 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)';
          ageGroupDisplay.style.borderColor = '#10b981';
          ageGroupDisplay.style.color = '#065f46';
        } else {
          ageGroupDisplay.textContent = 'Select birthdate to calculate';
          ageGroupDisplay.style.background = 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)';
          ageGroupDisplay.style.borderColor = '#0ea5e9';
          ageGroupDisplay.style.color = '#0c4a6e';
        }
      });
      
      // Radio option selection styling
      document.querySelectorAll('.radio-option input').forEach(input => {
        input.addEventListener('change', function() {
          const group = this.closest('.radio-group, .checkbox-group');
          if (group) {
            group.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
            this.closest('.radio-option').classList.add('selected');
          }
        });
      });
      
      // Auto-format user ID input
      document.getElementById('loginUserId').addEventListener('input', function(e) {
        let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        if (value.length > 2) {
          value = value.slice(0, 2) + '-' + value.slice(2, 7);
        }
        e.target.value = value;
      });
      
      // Load data
      loadRegistrations();
      loadCheckins();
    });
    
    // Registration form submission
    document.getElementById('attendanceForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const emailInput = document.getElementById('email');
      const email = emailInput.value;
      
      // Check if email exists
      const emailExists = await checkEmailExists(email);
      if (emailExists) {
        showToast('This email is already registered. Please use a different email.', 'error');
        emailInput.focus();
        return;
      }
      
      // Show confirmation
      const confirmed = await showConfirmation();
      if (!confirmed) {
        showToast('Registration cancelled', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<svg class="animate-spin" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/><path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg> Submitting...';
      
      // Get radio values safely
      const getRadioValue = (name) => {
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? el.value : '';
      };
      
      // Check if age group is calculated
      const ageGroup = document.getElementById('ageGroup').value;
      if (!ageGroup) {
        showToast('Please select your birthdate', 'error');
        document.getElementById('birthdate').focus();
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Submit Registration';
        return;
      }
      
      const formData = {
        first_name: document.getElementById('firstName').value,
        middle_initial: document.getElementById('middleInitial').value || '',
        last_name: document.getElementById('lastName').value,
        suffix: document.getElementById('suffix').value || '',
        email: email,
        gender: getRadioValue('gender'),
        age_group: ageGroup,
        birthdate: document.getElementById('birthdate').value,
        phone: document.getElementById('phone').value,
        nationality: document.getElementById('nationality').value,
        region: document.getElementById('region').value,
        province: document.getElementById('province').value,
        city: document.getElementById('city').value,
        barangay: document.getElementById('barangay').value,
        building: document.getElementById('building').value,
        street: document.getElementById('street').value || '',
        sector: getRadioValue('sector'),
        agency: document.getElementById('agency').value,
        office: document.getElementById('office').value,
        designation: document.getElementById('designation').value,
        senior_citizen: getRadioValue('seniorCitizen'),
        abled: getRadioValue('abled'),
        solo_parent: getRadioValue('soloParent'),
        civil_status: getRadioValue('civilStatus')
      };
      
      const result = await saveRegistration(formData);
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Submit Registration';
      
      if (!result.success) {
        showToast(result.error || 'Failed to save registration', 'error');
        return;
      }
      
      const userId = result.data.user_id;
      const registrationNumber = result.data.registration_number;
      const fullName = `${formData.first_name} ${formData.last_name}`;
      saveUserIdToStorage(userId);
      
      // Generate QR code URL and check-in link
      const checkinLink = window.location.origin + window.location.pathname + '?id=' + userId;
      const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(checkinLink)}`;
      
      showToast('Registration submitted successfully!');
      
      // Show success modal with QR code
      const modal = document.createElement('div');
      modal.className = 'confirmation-modal';
      modal.innerHTML = `
        <div class="confirmation-content" style="max-width: 480px;">
          <div style="text-align: center; margin-bottom: 12px;">
            <svg width="50" height="50" fill="#10b981" viewBox="0 0 24 24" style="margin: 0 auto;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <h3 style="font-size: 20px; font-weight: 700; color: #1e293b; text-align: center; margin-bottom: 4px;">
            Registration Successful!
          </h3>
          <p style="color: #64748b; text-align: center; margin-bottom: 16px; font-size: 14px;">
            Welcome, <strong>${fullName}</strong> (Reg #${registrationNumber})
          </p>
          
          <!-- Printable Card Section -->
          <div id="printableCard" style="background: white; border: 2px solid #0ea5e9; border-radius: 16px; padding: 20px; margin-bottom: 16px;">
            <div style="text-align: center; margin-bottom: 12px;">
              <p style="font-size: 12px; color: #64748b; margin-bottom: 4px;">DTC Tuguegarao - Your Check-in ID</p>
              <p style="font-size: 28px; font-weight: 700; color: #0c4a6e; letter-spacing: 3px; font-family: monospace; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 12px; border-radius: 8px;">
                ${userId}
              </p>
            </div>
            <div style="text-align: center; margin-bottom: 12px;">
              <p style="font-size: 11px; color: #64748b; margin-bottom: 8px;">Scan QR Code for quick check-in:</p>
              <img id="qrCodeImg" src="${qrCodeUrl}" alt="QR Code" style="width: 150px; height: 150px; border: 2px solid #e2e8f0; border-radius: 8px; padding: 4px; background: white;">
            </div>
            <div style="text-align: center;">
              <p style="font-size: 10px; color: #94a3b8; word-break: break-all;">${checkinLink}</p>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
            <button id="copyIdBtn" style="padding: 10px; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">
              üìã Copy ID
            </button>
            <button id="copyLinkBtn" style="padding: 10px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">
              üîó Copy Link
            </button>
          </div>
          <button id="downloadCardBtn" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 12px; font-size: 14px;">
            üì• Download / Print Card
          </button>
          <p style="color: #ef4444; text-align: center; font-size: 12px; font-weight: 600; margin-bottom: 12px;">
            ‚ö†Ô∏è Screenshot or download this! You need the ID for check-ins.
          </p>
          <button id="proceedCheckin" class="confirm-yes" style="width: 100%;">
            ‚ûú Proceed to Check In
          </button>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Copy ID button
      document.getElementById('copyIdBtn').addEventListener('click', function() {
        navigator.clipboard.writeText(userId).then(() => {
          this.innerHTML = '‚úÖ Copied!';
          showToast('User ID copied!');
          setTimeout(() => { this.innerHTML = 'üìã Copy ID'; }, 2000);
        }).catch(() => showToast('Failed to copy', 'error'));
      });
      
      // Copy Link button
      document.getElementById('copyLinkBtn').addEventListener('click', function() {
        navigator.clipboard.writeText(checkinLink).then(() => {
          this.innerHTML = '‚úÖ Copied!';
          showToast('Check-in link copied!');
          setTimeout(() => { this.innerHTML = 'üîó Copy Link'; }, 2000);
        }).catch(() => showToast('Failed to copy', 'error'));
      });
      
      // Download/Print Card button
      document.getElementById('downloadCardBtn').addEventListener('click', function() {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>DTC Check-in Card - ${userId}</title>
            <style>
              body { font-family: 'Segoe UI', Arial, sans-serif; padding: 20px; display: flex; justify-content: center; }
              .card { border: 3px solid #0ea5e9; border-radius: 16px; padding: 30px; max-width: 350px; text-align: center; }
              .title { font-size: 14px; color: #64748b; margin-bottom: 8px; }
              .name { font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 5px; }
              .reg { font-size: 12px; color: #64748b; margin-bottom: 15px; }
              .user-id { font-size: 36px; font-weight: 700; color: #0c4a6e; letter-spacing: 4px; font-family: monospace; background: #f0f9ff; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
              .qr-label { font-size: 12px; color: #64748b; margin-bottom: 10px; }
              .qr-code { width: 180px; height: 180px; border: 2px solid #e2e8f0; border-radius: 10px; padding: 5px; }
              .link { font-size: 10px; color: #94a3b8; word-break: break-all; margin-top: 15px; }
              @media print { body { padding: 0; } }
            </style>
          </head>
          <body>
            <div class="card">
              <p class="title">DTC Tuguegarao - Check-in Card</p>
              <p class="name">${fullName}</p>
              <p class="reg">Registration #${registrationNumber}</p>
              <div class="user-id">${userId}</div>
              <p class="qr-label">Scan for quick check-in:</p>
              <img class="qr-code" src="${qrCodeUrl}" alt="QR Code">
              <p class="link">${checkinLink}</p>
            </div>
            <script>window.onload = function() { window.print(); }<\/script>
          </body>
          </html>
        `);
        printWindow.document.close();
      });
      
      document.getElementById('proceedCheckin').addEventListener('click', function() {
        modal.remove();
        switchTab('login');
        document.getElementById('loginUserId').value = userId;
        window.scrollTo({ top: 0, behavior: 'smooth' });
        showToast('Select your services to complete check-in');
      });
      
      this.reset();
      document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
      // Reset age group display
      document.getElementById('ageGroup').value = '';
      const ageGroupDisplay = document.getElementById('ageGroupDisplay');
      ageGroupDisplay.textContent = 'Select birthdate to calculate';
      ageGroupDisplay.style.background = 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)';
      ageGroupDisplay.style.borderColor = '#0ea5e9';
      ageGroupDisplay.style.color = '#0c4a6e';
    });
    
    // Check-in form submission
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const selectedServices = Array.from(document.querySelectorAll('input[name="services"]:checked'))
        .map(cb => cb.value);
      
      if (selectedServices.length === 0) {
        document.getElementById('serviceError').style.display = 'block';
        showToast('Please select at least one service', 'error');
        return;
      }
      
      document.getElementById('serviceError').style.display = 'none';
      
      const userId = document.getElementById('loginUserId').value.toUpperCase();
      
      // Check if user ID exists
      const userCheck = await checkUserIdExists(userId);
      if (!userCheck.exists) {
        showToast('User ID not found. Please register first.', 'error');
        return;
      }
      
      // Show confirmation
      const confirmed = await showConfirmation();
      if (!confirmed) {
        showToast('Check-in cancelled', 'error');
        return;
      }
      
      const loginBtn = document.getElementById('loginBtn');
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<svg class="animate-spin" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/><path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg> Checking in...';
      
      const checkinRecord = {
        user_id: userId,
        services: selectedServices.join(', ')
      };
      
      const result = await saveCheckin(checkinRecord);
      
      loginBtn.disabled = false;
      loginBtn.innerHTML = '<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/></svg> Check In';
      
      if (!result.success) {
        showToast(result.error || 'Failed to check in', 'error');
        return;
      }
      
      showToast('Check-in successful!');
      
      // Reset checkboxes
      document.querySelectorAll('input[name="services"]').forEach(cb => cb.checked = false);
    });
    
  </script>
</body>
</html>
